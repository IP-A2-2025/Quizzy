***************Beginning Page***************
***************page number:1**************
IV.5. Gestiunea memoriei

***************Ending Page***************

***************Beginning Page***************
***************page number:2**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Gestlunea memonel
Functii
' alocarea zonelor de memories cétre aplicapii
' prevenirea interferengelor intre aplicatii
- detectarea $i oprirea acceselor incorecte
—1\7

***************Ending Page***************

***************Beginning Page***************
***************page number:3**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Problema fundamentalé
- mai multe aplicatii a zone dc memorie
disjuncte
' ﬁecare aplicapie —> anumite zone dc
memorie; care sunt aceste zone?
i depind dc ocuparea memoriei la ace] moment
i nu pot ﬁ cunoscute la compilare
—1\x

***************Ending Page***************

***************Beginning Page***************
***************page number:4**************
Arhilectun calcullloarelor 5i sineme a: 0pm“ - pan“ a ll-a
Solutla

~ doué tipuri de adrese

i virtuale — aplicatia crede 051 le acceseazz'l

i ﬁzice - sunl accesate in realitate
- corespondenta intre adresele virtuale $i cele

ﬁzice — gestionaté de sistemul de operare
—1\9

***************Ending Page***************

***************Beginning Page***************
***************page number:5**************
Arhilectllra calcullloarelor 5i sixleme a: 0pm“ - pine: a ll-a
Adrese v1rtuale $1 ﬁzwe (1)
Memona
DZ.“ 0
PA "a am 1 m‘
mun I’! 0L1 Mn I
Adm» Hmmle )nhese llzlw Ailxexe Kn flnle

***************Ending Page***************

***************Beginning Page***************
***************page number:6**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Adrese virtuale §i ﬁzice (2)
Gestionarea adreselor ﬁzice $i virtuale
~ 2 metode diferite
i segmentare
i paginare
- pot ﬁ folosite 5i impreuné
- componentﬁ dsdicati a procesorului - MMU
(Memory Management Unit)

***************Ending Page***************

***************Beginning Page***************
***************page number:7**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
IV.5. 1 . Segmentarea
memoriei

***************Ending Page***************

***************Beginning Page***************
***************page number:8**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Principiul de bazé (1)
- segment - zoné continué dc memorie
~ conﬁne informatii de acelasi tip (cod, date
etc.)
' vizibil programatorului
' adresa unei locaﬁi - formaté din 2 pérti
i adresa de inceput a segmentului
i deplasamentul in cadrul segmentului (ofﬁvet)
—m

***************Ending Page***************

***************Beginning Page***************
***************page number:9**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Principiul de bazé (2)
' la ruléri diferite ale programului,
segmentele incep la adrese diferite
' efectul asupra adreselor locatiilor
i adresa de inceput a segmentului lrebuie
actualizati
i deplasamentul - nemodiﬁcat
- problema este rezolvatﬁ numai paqial
i dorim ca adresa s5 nu ﬁe modiﬁcaté deloc
m

***************Ending Page***************


***************Beginning Page***************
***************page number:10**************
Arhilectun calcullloarelor 5i sixteme a: 0pm“ - pan“ a ll-a
Descnpton (1)

' descriptor de segment - structuré de date

pentru gestionarea unui segment
' informatii retinute

i adresa de inceput

i dimensiunea

i drepturi de acces

— etc.
—|15

***************Ending Page***************

***************Beginning Page***************
***************page number:11**************
Arhilectlln calcullloarelar 5i 5mm do 0pm“ - pan" a ll-a
Descriptori (2)
- descriptorii - plasati intr-un tabel
~ accesul la un segment - pe baza indicelui in
tabelul de descriptori (selector)
- adresa virtualé - 2 componente
i indicele in tabelul de descriptori
i deplasamentul in cadrul segmentului
- adresa ﬁzicﬁ = adresa de inceput a
segmentului + deplasamentul
lZﬁ

***************Ending Page***************

***************Beginning Page***************
***************page number:12**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Descriptori (3)
' la ruléri diferite ale programului,
segmentele incep la adrese diferite
' efectul asupra adreselor locapiilor
i nici unul
i trebuie modiﬁcatz'l doar adresa de inceput a
segmentului in descriptor
i o singuré data‘) (1a incércarea segmentului in
memorie)
i sarcina sistemului de operare
117

***************Ending Page***************

***************Beginning Page***************
***************page number:13**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Accesul la memone (1)
' programul precizeazé adresa vinuali
' identiﬁcare descriptor segment
' veriﬁcare drepturi acces
i drepturi insuﬁciente - generare exceptie
- veriﬁcare deplasament
i daci deplasamentul depé$e$te dimensiunea
segmentului - generare exceptie
—m;

***************Ending Page***************

***************Beginning Page***************
***************page number:14**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Accesul la memone (2)

' dacé s-a produs 0 eroare 1a pa$ii anteriori

— rutina de tratare a exceptiei termini programul
' dacé nu s-a produs nici 0 eroare

i calcul adresi ﬁzicﬁ (adresé inceput segment +

deplasament)
i acces 1a adresa calculatﬁ
—119

***************Ending Page***************

***************Beginning Page***************
***************page number:15**************
Amman" calcullloarelar 5i 5mm do 0pm“ - pan“ a ll-a
Exempliﬁcare (l)
Tabel descriptori (simpliﬁcat)

Indies

0 65000 43000

1 2| I 000 1 5500

2 20000 30000

3 155000 49000

4 250000 35000
—m

***************Ending Page***************

***************Beginning Page***************
***************page number:16**************
Arhilectun calcullloarelor 5i sineme a: 0pm“ - pan“ a ll-a
Exempliﬁcare (2)
Exemplu l:
mov byte ptr ds: [eax] , 25
- ds = 3 —> adresa inceput segment = 155000
- eax = 27348 < 49000
i deplasament valid (nu depé$e$te dimensiunea
segmentului)
- adresa ﬁzicé: 155000 + 27348 = 182348

***************Ending Page***************

***************Beginning Page***************
***************page number:17**************
Arhilectun calcullloarelor 5i sineme a: 0pm“ - pan“ a ll-a
Exempliﬁcare (3)

Exemplu 2:
add dword ptr ss: [ebp] , 4
' ss I 1 —> adresa inceput segment: 211000
' ebp: 19370> 15500

i deplasament invalid (depi5este dimensiunea

segmentului)

i eroare —> generare excepgie

—|sz

***************Ending Page***************

***************Beginning Page***************
***************page number:18**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Zone llbere $1 ocupate (1)
Problemé
~ crearea unui segment nou H plasare in
memorie
' este necesaré 0 zoné liberé continué
suﬁcient dc mare
- pot exista mai multe asemenea zone - care
este aleasé?
—131

***************Ending Page***************


***************Beginning Page***************
***************page number:19**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Zone libere 5i ocupate (2)
Algoritmi dc plasare in memorie
- First Fit - prima zoné liberé gésité suﬁcicnt
de mare
' Best F it - cea mai micé zoni liberi suﬁcient
de mare
- Worst Fit - cea mai mare zoné liberé (dacﬁ
este suﬁcient de mare)
—m

***************Ending Page***************

***************Beginning Page***************
***************page number:20**************
Amman" calcullloarelar 5i sisteme do 0pm“ - pan“ a ll-a
Zone llbere $1 ocupate (3)
/i 7mm hlvele
J J/ Ii x
-
Fll H FAI 3:4 FA‘ anhf FII
SEQURH! lmll
135

***************Ending Page***************

***************Beginning Page***************
***************page number:21**************
Arhilectlln calcullloarelar 5i 5mm do 0pm“ - pan" a ll-a
Fragmentare (1)
Fragmentarea externé a memoriei
' multe zone libere prea mici pentru a ﬁ
utilizate
' apare dupi un numér mare de alocéri 5i
eliberéri de segmente
' indiferent de algoritmul folosit
' plasarea unui segment poate egua, chiar
dacé spatiul liber total ar ﬁ suﬁcient
136

***************Ending Page***************

***************Beginning Page***************
***************page number:22**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Fragmentare (2)
Eliminarea fragmentérii externe
- compactarea memoriei
i deplasarea segmentelor astfel incit $51 nu mai
existe zone libere intre ele
i se creazé 0 singurz'i zoné liberé, de dimensiune
maxim?!
i realizati de un program specializat, parte a
sistemului de operate
137

***************Ending Page***************

***************Beginning Page***************
***************page number:23**************
Arhilectllra calcullloarelor 5i sixteme a: open“ - pan“ a ll-a
Compactare ( 1 )
W 21w hlvrv e i
I-I——--—I
2mm him .1 j‘
I-—I_
\38

***************Ending Page***************

***************Beginning Page***************
***************page number:24**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Compactare (2)

Rularea programului de compactare a

memoriei
' consumé mult timp

i mutarea segmentelor in memorie

i actualizarca dcscriptorilor dc segment
' nu poate ﬁ rulat foarte des
' numai cénd este necesar

139

***************Ending Page***************

***************Beginning Page***************
***************page number:25**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Compactare (3)

Situatii in care se poate decide rularea
programului de compactare

' cénd plasarea in memorie a unui segment
e§ueazé din lipsé de spatiu

- 1a intervale regulate de timp

- cénd gradul de fragmentare a memoriei
depi§e§te un anumit nivel

—un

***************Ending Page***************

***************Beginning Page***************
***************page number:26**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Segmentarea - concluzii
Probleme ale mccanismului de segmentare
' gestiune complicaté
— suprapunerea segmentelor » greu de detectat
' fragmentarea externé - de obicei puternici
i mult spatiu liber nefolosit
' compactarea consumé timp
—u\

***************Ending Page***************


***************Beginning Page***************
***************page number:27**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
IV.5.2 . Paginarea memoriei

***************Ending Page***************

***************Beginning Page***************
***************page number:28**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Principiul de bazé
- spapiul adreselor virtuale - impﬁrtit in pagini
(Pagw)
i zone de dimensiune ﬁxi
' spapiul adreselor ﬁzice - impirﬁt in cadre de
paginé (page frames)
i aceea$i dimensiune ca 5i paginile
' dimensiune - uzual 4 KB

***************Ending Page***************

***************Beginning Page***************
***************page number:29**************
Arhilectlln calcullloarelar 5i 5mm do 0pm“ - pan" a ll-a
Tabele de paginare (1)
~ corespondenta Tntre pagini $i cadre de
pagini - sarcina sistemului de operate
' structura de bazé - tabelul de paginare
' cite unul pentru ﬁecare proces care mleazé
- permits detectarea acceselor incorecte la
memorie
—m

***************Ending Page***************

***************Beginning Page***************
***************page number:30**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Tabele de paginare (2)
' 1a ruléri diferite ale programului, paginile
sunt plasate in cadre diferite
' efectul asupra adreselor locagiilor
i nici unul
i trebuie modiﬁcat tabelul de paginare
— 0 singuré daté (1a incércarea paginii in
memorie)
— sarcina sistemului de operare
145

***************Ending Page***************

***************Beginning Page***************
***************page number:31**************
Arhilectlln calcullloarelar 5i 5mm do 0pm“ - pan" a ll-a
Accesul la memone
- programul precizeazé adresa virtualé
' se determiné pagina din care face parte
- se cauté pagina in tabelul de paginare
i daci nu este gésitz'l — generare exceptie
- se determinﬁ cadrul de paginé corespunzétor
' calcul adresi ﬁzicé.
~ acces la adresa calculatﬁ
—uo

***************Ending Page***************

***************Beginning Page***************
***************page number:32**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Exempliﬁcare (l)

Tabel de paginare (simpliﬁcat)
mill-Inn
M616“ IIIIIIIE
—u7

***************Ending Page***************

***************Beginning Page***************
***************page number:33**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Exempliﬁcare (2)
Exemplu l:
' dimensiunea paginii: 1000
' adresa virtualé: 8039
i pagina: [8039/1000]=8 ~> cadrul de paginé 3
i deplasament: 80.39%1000139 (in cadrul
paginii)
- adresa ﬁzicﬁ: 3‘1000+39=3039
—ux

***************Ending Page***************

***************Beginning Page***************
***************page number:34**************
Arhilectun calcullloarelor 5i sineme a: 0pm“ - pan“ a ll-a
Exempliﬁcare (3)

Exemplu 2:
~ dimensiunca paginii: 1000
' adresa virtualé: 5276

i pagina: [5276/1000]=5

i nu apare in labelul de paginare

i eroare a generare exceptie
—ua

***************Ending Page***************

***************Beginning Page***************
***************page number:35**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Restncpl
Construirea tabelelor de paginare
' sarcina sistemului de operare
' trebuie sé evite suprapunerile intre aplicatii
~ restrictii
i o paginé virtualé poate s5 aparz'i pe cel mult 0
pozigie intr-un tabel de paginare
i un cadru de paginé ﬁzicé poate s5 aparé cel
mult 0 dati in toate tabelele de paginare
existente la un moment dat
—|.=n

***************Ending Page***************


***************Beginning Page***************
***************page number:36**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Fragmentare (1)
Fragmentarea interné a memoriei
' intre pagini nu existé spatiu a nu apare
fragmentare externé
' fragmentarea interné
— spaﬁu liber nefolosit in interiorul unei pagini
— nu poate ﬁ preluat de alt proces
i nu se poate face compactare
- mai putin sevsré deceit fragmentarea externé
m

***************Ending Page***************

***************Beginning Page***************
***************page number:37**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Fragmentare (2)
Alegerea dimensiunii paginilor
- putere a lui 2 (nu rémén rcsturi dc paginé)
' odati aleasé, nu se mai schimbi
' se stabile§te ca un compromis
i prea mare — fragmentare intemé putemici
i prea micé — mult spatiu ocupat de tabelele de
paginare
— uzual - 4 KB
—|_=1

***************Ending Page***************

***************Beginning Page***************
***************page number:38**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Chiar atét de simplu?

Procesor pe 32 biﬁ
' spaﬁu de adrese: 4 GB (:232)
' dimensiunea paginii: 4 KB (:212)
—> tabel cu 220 elemente

i ar ocupa prea mull 100

i consumi din memoria disponibili aplicatiilor
- la procesoarele pe 64 biti - 5i mai réu

***************Ending Page***************

***************Beginning Page***************
***************page number:39**************
Arhilectun calcullloarelor 5i sineme a: 0pm“ - pan“ a ll-a
Solutia 1

- tabele de pagini inversate
~ nu se retin toate ccle 220 elements

i doar paginile folosite
' plasare/céutare in tabel - functie hush
' greu dc implementat in hardware

i vitezé

i evitare coliziuni
—m

***************Ending Page***************

***************Beginning Page***************
***************page number:40**************
Arhilectlln calcullloarelor 5i sineme a: upmn - pm" a ll-a
Solutia 2
- tabele pe mai multe nivele
~ cazul Intel - 2 nivele
i catalog de pagini (Page Directory)
i tabel de pagini (Page Table)
- elementele din catalog - adrese de tabele de
pagini
' se aloci doar tabelele dc pagini folosite
—|.=5

***************Ending Page***************

***************Beginning Page***************
***************page number:41**************
Amman" calcullloarelar 5i 5mm do 0pm“ - pan“ a ll-a
Structura Intel
Adm-s a virtualn
31 22 21 12 11 U
———
(‘amlug a? pagiui Tnbel a? pagini Pagiln
— -
- Aiu-m ﬁzicn
— -
156

***************Ending Page***************

***************Beginning Page***************
***************page number:42**************
Arhilectlln calcullloarelnr 5i sineme do upmn - pan" a ll-a
Performanya (l)
- cataloagele $i tabelele dc pagini se aﬂé in
memorie
i prea mari pentru a ﬁ retinute in procesor
i prca multc - spcciﬁcc ﬁccérui proccs
' efect — performanté scézuté
i pentru ﬁecare acces 1a memorie solicitat de
proccs - 2 acccsc suplimcmarc
' solutia - cache dedicat
157

***************Ending Page***************

***************Beginning Page***************
***************page number:43**************
Arhilectun calcullloarelor 5i sineme a: 0pm“ - pan“ a ll-a
Performanya (2)
' TLB (Translation Lookaside Buﬂer)
— in interiorul procesorului
i retine corespondente intre pagini virtuale $i
cadre de paginé ﬁzice
i ultimele accesate
i trebuie invalidat atunci cénd se trece 1a execugia
almi proces
—|ss

***************Ending Page***************

